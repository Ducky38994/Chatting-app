<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEURALINK CHAT // SECURE</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --cyan:#00f5d4;
  --purple:#9d4edd;
  --bg:#05050a;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  min-height:100vh;
  background:linear-gradient(135deg,#05050a,#140a28);
  font-family:'Rajdhani',sans-serif;
  color:var(--cyan);
}
.container{
  max-width:1200px;
  margin:30px auto;
  min-height:90vh;
  display:flex;
  background:rgba(5,5,15,.9);
  backdrop-filter:blur(14px);
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 30px 80px rgba(0,0,0,.8);
}
.info-panel{
  flex:1;
  padding:40px;
  border-right:1px solid rgba(157,78,221,.3);
}
.info-panel h1{
  font-family:'Orbitron',monospace;
  font-size:2.6rem;
  margin-bottom:20px;
}
.info-panel p{color:#a0a0c0;margin-bottom:14px}
.panel{
  flex:1;
  padding:40px;
}
.hidden{display:none}
.panel-header{
  font-family:'Orbitron',monospace;
  letter-spacing:3px;
  color:var(--purple);
  margin-bottom:20px;
}
.form-group{margin-bottom:18px}
label{
  font-family:'Orbitron',monospace;
  font-size:.75rem;
  color:var(--purple);
}
input{
  width:100%;
  padding:14px 18px;
  border-radius:999px;
  background:rgba(15,15,35,.9);
  border:1px solid rgba(157,78,221,.4);
  color:var(--cyan);
  margin-top:6px;
}
input:focus{outline:none;border-color:var(--cyan)}
button{
  width:100%;
  margin-top:14px;
  padding:14px;
  border-radius:999px;
  background:transparent;
  border:1px solid var(--cyan);
  color:var(--cyan);
  font-family:'Orbitron',monospace;
  cursor:pointer;
}
button:hover{box-shadow:0 0 8px rgba(0,245,212,.4)}
#messages{
  height:300px;
  overflow-y:auto;
  background:rgba(5,5,15,.95);
  padding:16px;
  border-radius:12px;
  margin:16px 0;
  font-family:monospace;
}
.message{
  margin-bottom:10px;
  padding:8px 12px;
  border-left:2px solid var(--cyan);
}
.room-actions{display:flex;gap:10px}
.room-actions button{width:auto}
</style>
</head>

<body>
<div class="container">

<!-- INFO -->
<div class="info-panel">
  <h1>NEURALINK CHAT</h1>
  <p>SECURE ENCRYPTED COMMUNICATION</p>
  <p>ACCESS LEVEL: OMEGA</p>
</div>

<!-- AUTH -->
<div class="panel" id="authPanel">
  <div class="panel-header">ACCESS TERMINAL</div>

  <div id="loginForm">
    <div class="form-group">
      <label>EMAIL</label>
      <input id="email">
    </div>
    <div class="form-group">
      <label>PASSWORD</label>
      <input id="password" type="password">
    </div>
    <button onclick="signIn()">LOGIN</button>
    <button onclick="showRegister()">REGISTER</button>
    <p id="debug"></p>
  </div>

  <div id="registerForm" class="hidden">
    <div class="form-group">
      <label>EMAIL</label>
      <input id="registerEmail">
    </div>
    <div class="form-group">
      <label>PASSWORD</label>
      <input id="registerPassword" type="password">
    </div>
    <button onclick="signUp()">CREATE ACCOUNT</button>
    <button onclick="showLogin()">BACK</button>
  </div>
</div>

<!-- CHAT -->
<div class="panel hidden" id="chatPanel">
  <div class="panel-header">ENCRYPTED CHANNEL</div>

  <div id="joinRoom">
    <input id="roomCode" placeholder="ROOM CODE">
    <button onclick="joinRoom()">JOIN ROOM</button>
  </div>

  <div id="chat" class="hidden">
    <div id="currentRoom"></div>
    <div id="messages"></div>
    <div class="room-actions">
      <input id="messageInput" placeholder="MESSAGE">
      <button onclick="sendMessage()">SEND</button>
    </div>
    <button onclick="leaveRoom()">LEAVE</button>
  </div>
</div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database-compat.js"></script>

<script>
/* ðŸ”‘ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyBK4pJpKtFPs19-J051xR6t77SBHYrg1k8",
  authDomain: "subpls-2c774.firebaseapp.com",
  databaseURL: "https://subpls-2c774-default-rtdb.firebaseio.com",
  projectId: "subpls-2c774",
  storageBucket: "subpls-2c774.appspot.com",
  messagingSenderId: "834082653588",
  appId: "1:834082653588:web:a7b266363aa864249f3b81"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

/* STATE */
let roomCode=null;
let roomKey=null;

/* UI */
function showRegister(){
  loginForm.classList.add("hidden");
  registerForm.classList.remove("hidden");
}
function showLogin(){
  registerForm.classList.add("hidden");
  loginForm.classList.remove("hidden");
}

/* AUTH */
function signUp(){
  auth.createUserWithEmailAndPassword(
    registerEmail.value,
    registerPassword.value
  ).catch(e=>debug.textContent=e.message);
}

function signIn(){
  auth.signInWithEmailAndPassword(
    email.value,
    password.value
  ).catch(e=>debug.textContent=e.message);
}

auth.onAuthStateChanged(user=>{
  if(user){
    authPanel.classList.add("hidden");
    chatPanel.classList.remove("hidden");
  }else{
    authPanel.classList.remove("hidden");
    chatPanel.classList.add("hidden");
  }
});

/* ENCRYPTION */
async function deriveKey(code){
  const enc=new TextEncoder();
  const base=await crypto.subtle.importKey(
    "raw",enc.encode(code),"PBKDF2",false,["deriveKey"]
  );
  return crypto.subtle.deriveKey(
    {name:"PBKDF2",salt:enc.encode("neuralink"),iterations:100000,hash:"SHA-256"},
    base,{name:"AES-GCM",length:256},false,["encrypt","decrypt"]
  );
}
async function encrypt(text,key){
  const iv=crypto.getRandomValues(new Uint8Array(12));
  const data=await crypto.subtle.encrypt(
    {name:"AES-GCM",iv},key,new TextEncoder().encode(text)
  );
  return {iv:Array.from(iv),data:Array.from(new Uint8Array(data))};
}
async function decrypt(payload,key){
  const data=await crypto.subtle.decrypt(
    {name:"AES-GCM",iv:new Uint8Array(payload.iv)},
    key,new Uint8Array(payload.data)
  );
  return new TextDecoder().decode(data);
}

/* ROOMS */
async function joinRoom(){
  roomCode=document.getElementById("roomCode").value.trim();
  if(!roomCode)return;
  roomKey=await deriveKey(roomCode);
  joinRoomDiv.classList.add("hidden");
  chat.classList.remove("hidden");
  currentRoom.textContent="ROOM: "+roomCode;
  loadMessages();
}

function leaveRoom(){
  roomCode=null;
  roomKey=null;
  chat.classList.add("hidden");
  joinRoomDiv.classList.remove("hidden");
}

/* CHAT */
async function sendMessage(){
  if(!roomCode||!roomKey)return;
  const text=messageInput.value.trim();
  if(!text)return;
  const encrypted=await encrypt(text,roomKey);
  db.ref("rooms/"+roomCode+"/messages").push({
    encrypted,
    sender:auth.currentUser.email,
    ts:Date.now()
  });
  messageInput.value="";
}

function loadMessages(){
  messages.innerHTML="";
  db.ref("rooms/"+roomCode+"/messages")
    .limitToLast(50)
    .on("child_added",async snap=>{
      const msg=snap.val();
      const text=await decrypt(msg.encrypted,roomKey);
      const div=document.createElement("div");
      div.className="message";
      div.innerHTML="<b>"+msg.sender+":</b> "+text;
      messages.appendChild(div);
      messages.scrollTop=messages.scrollHeight;
    });
}
</script>
</body>
</html>
